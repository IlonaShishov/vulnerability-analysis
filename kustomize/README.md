# Procedure to Deploy

1. Set all your api keys and tokens in the following command. Note that all the keys are not required.
Look at this [Readme](../README.md) for more details.

```shell
cat > base/secrets.env << EOF
nvd_api_key=you_api_key
serpapi_api_key=your_api_key
tavily_api_key=your_api_key
nvidia_api_key=your_api_key
ghsa_api_key=your_api_key
ngc_api_key=your_api_key
EOF
```

2. If you don't have namespace , create it
```shell
export YOUR_NAMESPACE_NAME=yourNamespaceNameHere
oc new-project $YOUR_NAMESPACE_NAME
```

3. Create an image pull secret that is authorized to pull agent morpheus image:      
```shell
oc create secret generic morpheus-pull-secret --from-file=.dockerconfigjson=<path/to/.docker/config.json> --type=kubernetes.io/dockerconfigjson
```

4. Create an image pull secret that is authorized to pull images from ngrc.io:      
```shell
oc create secret generic ngrc-secret --from-file=.dockerconfigjson=<path/to/.docker/config.json> --type=kubernetes.io/dockerconfigjson
```

5. Deploy agent-morpheus + agent-morpheus-client to your namespace
```shell
oc kustomize overlays/nvidia-llm-service |  oc apply -f - -n $YOUR_NAMESPACE_NAME
```

6. Alternatively, if you want to deploy agent-morpheus with our self-hosted LLM, then run
```shell
# Deploy agent morpheus with Nim meta/llama-3.1-8b-16bit LLM 
oc kustomize overlays/local-nim-all |  oc apply -f - -n $YOUR_NAMESPACE_NAME
# Deploy agent morpheus with llama-3.1-70b-4bit LLM
oc kustomize overlays/local-llama3.1-70b-4bit |  oc apply -f - -n $YOUR_NAMESPACE_NAME
```
7. If you didn't deploy yet self-hosted embedding model and one of the above LLMs, first fetch latest version of agent-morpheus git submodule
```shell
git submodule init --recursive
git submodule update --merge --recursive
# Or if the local submodule sha is not updated to latest one, you can fetch it from remote tracking branch
git submodule update --remote --merge --recursive
```
8. Follow the instructions below 
    1. from your local repository
       ```shell
       cd ../agent-morpheus-models    
        ```
       [open instructions locally](../agent-morpheus-models/README.md)
   2. [Open instruction in browser](https://github.com/RHEcosystemAppEng/agent-morpheus-models)