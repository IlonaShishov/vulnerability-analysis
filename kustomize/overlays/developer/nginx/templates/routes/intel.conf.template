####################### Intel APIs #######################

location /serpapi {
    rewrite ^\/serpapi(\/.*)$ $1 break;
    proxy_pass https://serpapi.com;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;
}

location /nvd {
    rewrite ^\/nvd(\/.*)$ /rest$1 break;
    proxy_pass https://services.nvd.nist.gov;
    proxy_cache intel_cache;
    proxy_cache_valid 200 202 365d;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;
}

location /cve-details {
    rewrite ^\/cve-details(\/.*)$ $1 break;
    proxy_pass https://www.cvedetails.com;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;
}

location /cwe-details {
    rewrite ^\/cwe-details(\/.*)$ $1 break;
    proxy_pass https://cwe.mitre.org;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;

    error_page 301 302 307 = @handle_redirects;
}

location /first {
    rewrite ^\/first(\/.*)$ /data/v1$1 break;
    proxy_pass https://api.first.org;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;
}

location /recf {
    rewrite ^\/recf(\/.*)$ /v2$1 break;
    proxy_pass https://api.recordedfuture.com;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;
}

location /ghsa {
    rewrite ^\/ghsa(\/.*)$ $1 break;
    proxy_pass https://api.github.com;
    proxy_set_header Authorization $ghsa_http_authorization;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;
}

location /rhsa {
    rewrite ^\/rhsa(\/.*)$ /hydra/rest$1 break;
    proxy_pass https://access.redhat.com;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;
}

location /ubuntu {
    rewrite ^\/ubuntu(\/.*)$ $1 break;
    proxy_pass https://ubuntu.com;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;
}

location /depsdev {
    rewrite ^ $request_uri;
    rewrite ^\/depsdev\/(.*) $1 break;
    return 400;
    proxy_pass https://api.deps.dev/$uri;
    proxy_cache intel_cache;
    proxy_cache_methods GET;
    proxy_cache_key "$request_method|$request_uri";
    add_header X-Cache-Status $upstream_cache_status;
    client_body_buffer_size 4m;

    resolver dns-default.openshift-dns.svc.cluster.local 8.8.8.8 valid=60s;
}
