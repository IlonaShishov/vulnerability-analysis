
location /nvai {

   location ~* ^\/nvai\/v2\/nvcf\/((pexec\/functions\/.+)|(functions))$ {
      rewrite ^\/nvai(\/.*)$ $1 break;
      proxy_pass ${NGINX_UPSTREAM_NVAI};
      proxy_set_header Connection '';
      proxy_set_header Authorization $nvai_http_authorization;
      add_header X-Cache-Status $upstream_cache_status always;
      client_body_buffer_size 4m;

      access_log /dev/stdout nvai_cache_log;
      access_log /var/log/nginx/access.log nvai_cache_log;
   }

   location ~* ^\/nvai\/v2\/nvcf\/(pexec\/status\/.+)$ {
      rewrite ^\/nvai(\/.*)$ $1 break;
      proxy_pass ${NGINX_UPSTREAM_NVAI};
      proxy_set_header Connection '';
      proxy_set_header Authorization $nvai_http_authorization;
      add_header X-Cache-Status $upstream_cache_status always;
      client_body_buffer_size 4m;
   }

   location /nvai/v2 {
      rewrite ^\/nvai(\/.*)$ $1 break;
      proxy_pass ${NGINX_UPSTREAM_NVAI};
      access_log /dev/stdout no_cache_log;
      access_log /var/log/nginx/access.log no_cache_log;
   }
}
