import os
import json

def load_test_data(examples_dir):

    test_data = {}

    for output_file in os.listdir(examples_dir):
        if output_file.endswith('.json'):
            output_path = os.path.join(examples_dir, output_file)
            with open(output_path, 'r') as f:
                output_data = json.load(f)
                
                image_id = f'{output_data["input"]["image"]["name"]}-{output_data["input"]["image"]["tag"]}'
                for output in output_data["output"]:
                    matching_intel = next(
                        (intel for intel in output_data["info"]["intel"]
                        if intel["vuln_id"] == output["vuln_id"]),
                        None
                    )
                    case_data = {
                        "output": output,
                        "intel": matching_intel
                    }
                    cve_id = output["vuln_id"]
                    case_id = f'{cve_id}-{image_id}'
                    if case_id in test_data:
                        test_data[case_id].append(case_data)
                    else:
                        test_data[case_id] = [case_data]

    return test_data
