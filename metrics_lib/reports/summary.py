
from src.cve.nodes.cve_summary_node import SUMMARY_PROMPT

class SummaryMetrics:

    def __init__(self):

        self.name = "Summary Metrics"

        self.metrics = {
            "SemanticSimilarity": {},
            "LLMContextPrecisionWithoutReference": {},
            "LLMContextRecall": {},
            "Faithfulness": {},
            "ResponseRelevancy": {},
            "SummarizationScore": {},
        }

    def get_datasets(self, test_data):
        datasets = {}
        for case_id, case_data in test_data.items():
            dataset = []
            for item in case_data:
                output = item["output"]
                checklist_resp_lst = [check["response"] for check in output["checklist"]]
                checklist_resp_str = ', '.join(checklist_resp_lst)
                summary = output["summary"]
                data = {
                    "user_input": SUMMARY_PROMPT.format(response=checklist_resp_str),
                    "response": summary,
                    "reference": checklist_resp_str,
                    "reference_contexts": checklist_resp_lst,
                    "retrieved_contexts": checklist_resp_lst
                }
                dataset.append(data)
            datasets[case_id] = dataset
        return datasets
