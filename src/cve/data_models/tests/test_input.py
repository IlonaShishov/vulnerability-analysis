# SPDX-FileCopyrightText: Copyright (c) 2024, NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


from ..input import ArtifactSourceInfo, GitSourceInfo, ImageInfoInput, ManualSBOMInfoInput

def test_list():
    # Test data with a GitSourceInfo and an ArtifactSourceInfo
    data = {
        "name": "example-image",
        "sbom_info": { 
            "_type": "manual",
            "packages": []
        },
        "source_info": [
            {
                "_type": "git",
                "source_type": "code",
                "git_repo": "https://github.com/example/repo.git",
                "ref": "main",
                "include": ["*.py"],
                "exclude": ["*.md"]
            },
            {
                "_type": "artifact",
                "source_type": "doc",
                "path": "/path/to/artifact.zip",
                "compression": "zip",
                "include": ["*.pdf"],
                "exclude": ["*.tmp"]
            }
        ]
    }

    # Create an Example instance
    example = ImageInfoInput(**data)

    # Assertions to verify correct parsing
    assert example.name == "example-image"
    assert len(example.source_info) == 2

    # Check the first item (GitSourceInfo)
    assert isinstance(example.source_info[0], GitSourceInfo)
    assert not isinstance(example.source_info[0], ArtifactSourceInfo)
    assert example.source_info[0].type == "git"
    assert example.source_info[0].git_repo == "https://github.com/example/repo.git"
    assert example.source_info[0].ref == "main"
    assert example.source_info[0].include == ["*.py"]
    assert example.source_info[0].exclude == ["*.md"]

    # Check the second item (ArtifactSourceInfo)
    assert isinstance(example.source_info[1], ArtifactSourceInfo)
    assert example.source_info[1].type == "artifact"
    assert example.source_info[1].path == "/path/to/artifact.zip"
    assert example.source_info[1].compression == "none"
    assert example.source_info[1].include == ["*.pdf"]
    assert example.source_info[1].exclude == ["*.tmp"]